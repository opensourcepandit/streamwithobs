<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Stream</title>

    <script src="https://cdn.jsdelivr.net/npm/less@4.1.1"></script>
    <style>
        body {
          font-family: Arial, Helvetica, sans-serif;
        }
    
        * {
          box-sizing: border-box
        }
        .videocontainer {
            padding: 16px;
            margin-left: 35%; 
            margin-right: 35%; 
            margin-top: 10%;
        }
        @media screen and (max-width: 300px) {
            .video,
            .videocontainer {
              width: 100%;
              height: 100%;
            }
          }
    </style>
</head>

<body>
    <h1>Live Stream</h1>
    <div id="protected-message"></div>
    <div class="videocontainer">
        <video class="vid" id="video" controls autoplay />
    </div>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/hls.js@alpha"></script> -->
    <script>
        var video = document.getElementById("video");
        var videoSrc = "/hls/test.m3u8";

        if (Hls.isSupported()) {
            var hls = new Hls();
            hls.loadSource(videoSrc);
            hls.attachMedia(video);
        }
        else if (video.canPlayType("application/vnd.apple.mpegurl")) {
            video.src = videoSrc;
        }
    </script>
    <script>
        const token = sessionStorage.getItem('token');

        <!-- if (!token) {
            window.location.href = '/';
        } -->

        async function fetchProtectedResource() {
            try {
                const response = await fetch('/protected', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const protectedMessage = document.getElementById('protected-message');
                    protectedMessage.textContent = `Welcome, ${data.user.username}!`;
                } else {
                    console.log('Protected resource fetch failed:', response.status);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        fetchProtectedResource();
    </script>
</body>

</html>